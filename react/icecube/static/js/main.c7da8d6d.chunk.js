(this.webpackJsonpicecube=this.webpackJsonpicecube||[]).push([[0],{34:function(e,t,n){e.exports=n(44)},38:function(e,t,n){},44:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),a=n(26),c=n.n(a),u=(n(38),n(8)),i=n(4),l=n(5),s=n(14),f=n(1),p=n(27),d=n(13),m=n.n(d),b=n(9),y=n(7),g=n(46),k=function e(){Object(y.a)(this,e)};function v(e){var t=r.useState(!1),n=Object(i.a)(t,2),o=n[0],a=n[1];return r.useEffect((function(){console.log("[useKey] useEffect");var t=function(t){return e.toLowerCase()===t.key.toLowerCase()},n=function(e){t(e)&&a(!0)},r=function(e){t(e)&&a(!1)};return window.addEventListener("keydown",n),window.addEventListener("keyup",r),function(){window.removeEventListener("keydown",n),window.removeEventListener("keyup",r)}}),[e,a]),o}k.Vector3={get zero(){return new f.Vector3(0,0,0)},get one(){return new f.Vector3(1,1,1)},get up(){return new f.Vector3(0,1,0)},get down(){return new f.Vector3(0,-1,0)},get left(){return new f.Vector3(-1,0,0)},get right(){return new f.Vector3(1,0,0)},get forward(){return new f.Vector3(0,0,-1)},get back(){return new f.Vector3(0,0,1)}},k.Quaternion={get identity(){return new f.Quaternion(0,0,0,1)}};var h=function(){function e(){Object(y.a)(this,e)}return Object(b.a)(e,null,[{key:"generateGroundCubes",value:m.a.mark((function e(t){var n,r,o,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=-Math.floor(t.width/2),r=n+t.width,o=n;case 3:if(!(o<r)){e.next=14;break}a=0;case 5:if(!(a<t.depth)){e.next=11;break}return e.next=8,{uuid:Object(g.a)(),type:"gr",position:new f.Vector3(o,0,-a),rotation:k.Quaternion.identity,scale:k.Vector3.one,selected:!1};case 8:a++,e.next=5;break;case 11:o++,e.next=3;break;case 14:case"end":return e.stop()}}),e)}))},{key:"resetGroundCubes",value:function(e,t){for(var n=-Math.floor(e.width/2),r=n+e.width,o=0,a=n;a<r;a++)for(var c=0;c<e.depth;c++)t[o].position.set(a,0,-c),t[o].rotation.copy(k.Quaternion.identity),t[o].scale.copy(k.Vector3.one),o++}},{key:"generateBlocksCubes",value:m.a.mark((function e(t){var n,r,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=-Math.floor(t.width/2),r=0;case 2:if(!(r<t.blocks.length)){e.next=13;break}o=0;case 4:if(!(o<t.blocks[r].length)){e.next=10;break}return e.next=7,{uuid:Object(g.a)(),type:t.blocks[r][o],position:new f.Vector3(n+o,0,-(t.depth-1-r)),rotation:k.Quaternion.identity,scale:k.Vector3.one,selected:!1};case 7:o++,e.next=4;break;case 10:r++,e.next=2;break;case 13:case"end":return e.stop()}}),e)}))},{key:"resetBlocksCubes",value:function(e,t){for(var n=-Math.floor(e.width/2),r=0,o=0;o<e.blocks.length;o++)for(var a=0;a<e.blocks[o].length;a++)t[r].position.set(n+a,0,-(e.depth-1-o)),t[r].rotation.copy(k.Quaternion.identity),t[r].scale.copy(k.Vector3.one),r++}},{key:"generatePlayers",value:m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,{uuid:Object(g.a)(),type:"pl",position:new f.Vector3(t.playerPosition[0],t.playerPosition[1],t.playerPosition[2]),rotation:k.Quaternion.identity,scale:k.Vector3.one,selected:!1};case 2:case"end":return e.stop()}}),e)}))},{key:"resetPlayers",value:function(e){e.forEach((function(e){e.position.copy(k.Vector3.zero),e.rotation.copy(k.Quaternion.identity),e.scale.copy(k.Vector3.one)}))}},{key:"replaceStateArrayItem",value:function(e,t,n){return[].concat(Object(l.a)(e.slice(0,t)),[n(e[t])],Object(l.a)(e.slice(t+1)))}}]),e}(),w=k.Vector3.zero,E=k.Vector3.one,O=k.Vector3.left,j=k.Vector3.up,M={width:5,depth:10,playerPosition:[0,0,0],blocks:[["no","no","no","no","no"],["st","sp","no","st","st"]]},V=Object(p.a)((function(e,t){return{levelData:M,step:2,players:Array.from(h.generatePlayers(M)),ground:Array.from(h.generateGroundCubes(M)),blocks:Array.from(h.generateBlocksCubes(M)),get player(){return this.players[0]},setCubeGeometry:function(t){return e({cubeGeometry:t})},setGroundMaterial:function(t){return e({groundMaterial:t})},setNormalMaterial:function(t){return e({normalMaterial:t})},setSpecialMaterial:function(t){return e({specialMaterial:t})},setSteelMaterial:function(t){return e({steelMaterial:t})},setBombMaterial:function(t){return e({bombMaterial:t})},containsGround:function(e){return t().ground.some((function(t){return t.position.equals(e)&&t.scale.equals(E)}))},containsBlock:function(e){return t().blocks.some((function(t){return t.position.equals(e)&&t.scale.equals(E)}))},groundAt:function(e){return t().ground.find((function(t){return t.position.equals(e)&&t.scale.equals(E)}))},blockAt:function(e){return t().blocks.find((function(t){return t.position.equals(e)&&t.scale.equals(E)}))},getBomb:function(){return t().ground.find((function(e){return e.selected}))},canExplode:function(e){return"st"!==e.type},setLevelData:function(t){e({levelData:t,step:2,players:Array.from(h.generatePlayers(t)),ground:Array.from(h.generateGroundCubes(t)),blocks:Array.from(h.generateBlocksCubes(t)),animation:null})},reset:function(){var n=t();h.resetPlayers(n.players),h.resetGroundCubes(n.levelData,n.ground),h.resetBlocksCubes(n.levelData,n.blocks),e({step:2,players:n.players.map((function(e){return Object(s.a)(Object(s.a)({},e),{},{selected:!1})})),ground:n.ground.map((function(e){return Object(s.a)(Object(s.a)({},e),{},{selected:!1})})),blocks:n.blocks.map((function(e){return Object(s.a)(Object(s.a)({},e),{},{selected:!1})})),animation:null})},tryMovePlayer:function(n){var r=t(),o=A(r.player.position,n);if(r.containsGround(o)&&!r.containsBlock(o)){var a=r.step-1,c=f.MathUtils.degToRad(-90),u=0!==a?[x(r.player.position,o)]:[x(r.player.position,o)].concat(Object(l.a)(r.blocks.map((function(e){return x(e.position,A(e.position,[0,0,1]))}))),Object(l.a)(r.blocks.map((function(e){return B(e.rotation,C(e.rotation,O,c))}))));return e({step:0===a?2:a,animation:{duration:250,onFrame:function(e){return u.forEach((function(t){return t(e)}))},onRest:function(){e({animation:null}),r.containsBlock(r.player.position)&&r.reset()}}}),!0}return!1},placeBomb:function(){var n,r=t(),o=null!==(n=r.getBomb())&&void 0!==n?n:r.groundAt(r.player.position),a=r.ground.indexOf(o);if(o.selected){var c=r.blockAt(o.position);if(c&&r.canExplode(c)){for(var u=[],i=[c],p=function(e){e&&r.canExplode(e)&&i.push(e)};i.length>0;){var d=i.shift();u.push(d),"sp"===d.type&&(p(r.blockAt(A(c.position,[-1,0,0]))),p(r.blockAt(A(c.position,[1,0,0]))),p(r.blockAt(A(c.position,[0,0,-1]))),p(r.blockAt(A(c.position,[0,0,1]))),p(r.blockAt(A(c.position,[-1,0,-1]))),p(r.blockAt(A(c.position,[1,0,-1]))),p(r.blockAt(A(c.position,[1,0,-1]))),p(r.blockAt(A(c.position,[-1,0,1]))))}var m=f.MathUtils.degToRad(180),b=[].concat(Object(l.a)(u.map((function(e){return x(e.scale,w)}))),Object(l.a)(u.map((function(e){return B(e.rotation,C(e.rotation,j,m))}))));e({animation:{duration:250,onFrame:function(e){return b.forEach((function(t){return t(e)}))},onRest:function(){e({animation:null})}}})}}return e({ground:h.replaceStateArrayItem(r.ground,a,(function(e){return Object(s.a)(Object(s.a)({},e),{},{selected:!e.selected})}))}),!o.selected}}}));function A(e,t){return new f.Vector3(e.x+t[0],e.y+t[1],e.z+t[2])}function x(e,t){var n=e.clone();return function(r){e.lerpVectors(n,t,r)}}function C(e,t,n){return e.clone().multiply((new f.Quaternion).setFromAxisAngle(t,n))}function B(e,t){var n=e.clone();return function(r){f.Quaternion.slerp(n,t,e,r)}}var G=function(e){var t=V((function(e){return e.setCubeGeometry})),n=V((function(e){return e.setGroundMaterial})),o=V((function(e){return e.setNormalMaterial})),a=V((function(e){return e.setSpecialMaterial})),c=V((function(e){return e.setSteelMaterial})),l=V((function(e){return e.setBombMaterial})),s=Object(u.d)(),f=Object(i.a)(s,2),p=f[0],d=f[1],m=Object(u.d)(),b=Object(i.a)(m,2),y=b[0],g=b[1],k=Object(u.d)(),v=Object(i.a)(k,2),h=v[0],w=v[1],E=Object(u.d)(),O=Object(i.a)(E,2),j=O[0],M=O[1],A=Object(u.d)(),x=Object(i.a)(A,2),C=x[0],B=x[1],G=Object(u.d)(),P=Object(i.a)(G,2),Q=P[0],F=P[1];return console.log("[GameCache] const"),r.useEffect((function(){return S(d,t)}),[t,d]),r.useEffect((function(){return S(g,n)}),[n,g]),r.useEffect((function(){return S(w,o)}),[o,w]),r.useEffect((function(){return S(M,a)}),[a,M]),r.useEffect((function(){return S(B,c)}),[c,B]),r.useEffect((function(){return S(F,l)}),[l,F]),r.createElement(r.Fragment,null,r.createElement("boxBufferGeometry",{ref:p,args:[1,1,1]}),r.createElement("meshStandardMaterial",{ref:y,color:"black",transparent:!0,wireframe:!0}),r.createElement("meshStandardMaterial",{ref:h,color:"gray",transparent:!0}),r.createElement("meshStandardMaterial",{ref:j,color:"green",transparent:!0}),r.createElement("meshStandardMaterial",{ref:C,color:"black",transparent:!0}),r.createElement("meshStandardMaterial",{ref:Q,color:"orange",transparent:!0}),d&&g&&w&&M&&B&&F&&e.children)},S=function(e,t){e&&(console.log("[GameCache] useEffect",e),t(e))},P=r.memo((function(e){var t=e.type,n=e.position,o=e.rotation,a=e.scale,c=e.selected,l=r.useRef(null),s=r.useState(null),f=Object(i.a)(s,2),p=f[0],d=f[1],m=V((function(e){return e.cubeGeometry})),b=V((function(e){return e.groundMaterial})),y=V((function(e){return e.normalMaterial})),g=V((function(e){return e.specialMaterial})),k=V((function(e){return e.steelMaterial})),v=V((function(e){return e.bombMaterial}));return console.log("[Cube] const"),r.useEffect((function(){return console.log("[Cube] mount"),function(){return console.log("[Cube] unmount")}}),[]),r.useEffect((function(){if(c)d(v);else switch(t){case"pl":case"no":d(y);break;case"sp":d(g);break;case"st":d(k);break;case"gr":default:d(b)}}),[d,t,c,m,b,y,g,k,v]),Object(u.c)((function(){l.current.position.copy(n),l.current.setRotationFromQuaternion(o),l.current.scale.copy(a)})),r.createElement("mesh",{ref:l,geometry:m,material:p})})),Q=function(){var e=V((function(e){return e.ground})),t=V((function(e){return e.blocks})),n=V((function(e){return e.players}));return console.log("[Level] const"),r.createElement(r.Fragment,null,r.createElement("group",{position:[0,-1,0]},e.map((function(e){return r.createElement(P,Object.assign({key:e.uuid},e))}))),t.map((function(e){return r.createElement(P,Object.assign({key:e.uuid},e))})),n.map((function(e){return r.createElement(P,Object.assign({key:e.uuid},e))})))},F=n(32);Object(u.b)({OrbitControls:F.a});var L=function(){var e=r.useRef(null),t=Object(u.e)(),n=t.camera,o=t.gl.domElement;return console.log("[OrbitControlsElement] const"),Object(u.c)((function(){return e.current.update()})),r.createElement("orbitControls",{ref:e,args:[n,o]})},R=n(33),q=r.memo((function(e){var t=e.duration,n=e.onFrame,o=e.onRest;return console.log("[Animation] const"),Object(R.a)({config:{duration:t},from:{opacity:0},to:{opacity:1},reset:!0,onRest:o,onFrame:function(e){return n(e.opacity)}}),r.createElement(r.Fragment,null)})),D=function(){var e=V((function(e){return e.tryMovePlayer})),t=V((function(e){return e.placeBomb})),n=V((function(e){return e.reset})),o=V((function(e){return e.animation})),a=v("w"),c=v("a"),u=v("s"),i=v("d"),l=v(" "),s=v("escape");return r.useEffect((function(){o||a&&e([0,0,-1])||c&&e([-1,0,0])||u&&e([0,0,1])||i&&e([1,0,0])||(l?t():s&&n())}),[o,a,c,u,i,l,s,e,t,n]),o?r.createElement(q,o):r.createElement(r.Fragment,null)},z=function(){return console.log("[Game] const"),r.createElement(u.a,null,r.createElement("ambientLight",null),r.createElement("pointLight",{position:[10,10,10]}),r.createElement(L,null),r.createElement(D,null),r.createElement(G,null,r.createElement(Q,null)))};var I=function(){return o.a.createElement("div",{className:"vh-100 vw-100"},o.a.createElement(z,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(I,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[34,1,2]]]);
//# sourceMappingURL=main.c7da8d6d.chunk.js.map