(this.webpackJsonpicecube=this.webpackJsonpicecube||[]).push([[0],{34:function(e,n,t){e.exports=t(44)},38:function(e,n,t){},44:function(e,n,t){"use strict";t.r(n);var r=t(0),o=t.n(r),a=t(26),c=t.n(a),u=(t(38),t(27)),i=t(8),l=t(4),s=t(5),f=t(15),p=t(1),m=t(28),d=t(14),b=t.n(d),E=t(46),g=b.a.mark(v),w=b.a.mark(k);function y(e){var n=r.useState(!1),t=Object(l.a)(n,2),o=t[0],a=t[1];return r.useEffect((function(){console.log("[useKey] useEffect");var n=function(n){return e.toLowerCase()===n.key.toLowerCase()},t=function(e){n(e)&&a(!0)},r=function(e){n(e)&&a(!1)};return window.addEventListener("keydown",t),window.addEventListener("keyup",r),function(){window.removeEventListener("keydown",t),window.removeEventListener("keyup",r)}}),[e,a]),o}function v(e,n){var t,r,o,a;return b.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:t=-Math.floor(e/2),r=t+e,o=t;case 3:if(!(o<r)){c.next=14;break}a=0;case 5:if(!(a<n)){c.next=11;break}return c.next=8,{uuid:Object(E.a)(),type:"gr",position:new p.Vector3(o,0,-a),rotation:new p.Quaternion(0,0,0,1),scale:new p.Vector3(1,1,1),selected:!1};case 8:a++,c.next=5;break;case 11:o++,c.next=3;break;case 14:case"end":return c.stop()}}),g)}function k(e,n,t){var r,o,a;return b.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:r=-Math.floor(e/2),o=0;case 2:if(!(o<t.length)){c.next=13;break}a=0;case 4:if(!(a<t[o].length)){c.next=10;break}return c.next=7,{uuid:Object(E.a)(),type:t[o][a],position:new p.Vector3(r+a,0,-(n-1-o)),rotation:new p.Quaternion(0,0,0,1),scale:new p.Vector3(1,1,1),selected:!1};case 7:a++,c.next=4;break;case 10:o++,c.next=2;break;case 13:case"end":return c.stop()}}),w)}function O(e,n,t){return[].concat(Object(s.a)(e.slice(0,n)),[t(e[n])],Object(s.a)(e.slice(n+1)))}var h=new p.Vector3(1,1,1),j=Object(m.a)((function(e,n){return{step:2,player:(t=0,r=0,o=0,{uuid:Object(E.a)(),type:"pl",position:new p.Vector3(t,r,o),rotation:new p.Quaternion(0,0,0,1),scale:new p.Vector3(1,1,1),selected:!1}),ground:Array.from(v(5,10)),blocks:Array.from(k(5,10,[["no","no","no","no","no"],["st","sp","no","st","st"]])),setCubeGeometry:function(n){return e({cubeGeometry:n})},setGroundMaterial:function(n){return e({groundMaterial:n})},setNormalMaterial:function(n){return e({normalMaterial:n})},setSpecialMaterial:function(n){return e({specialMaterial:n})},setSteelMaterial:function(n){return e({steelMaterial:n})},setBombMaterial:function(n){return e({bombMaterial:n})},containsGround:function(e){return n().ground.some((function(n){return n.position.equals(e)&&n.scale.equals(h)}))},containsBlock:function(e){return n().blocks.some((function(n){return n.position.equals(e)&&n.scale.equals(h)}))},groundAt:function(e){return n().ground.find((function(n){return n.position.equals(e)&&n.scale.equals(h)}))},blockAt:function(e){return n().blocks.find((function(n){return n.position.equals(e)&&n.scale.equals(h)}))},getBomb:function(){return n().ground.find((function(e){return e.selected}))},canExplode:function(e){return"st"!==e.type},reset:function(){var t=n();e({ground:t.ground.map((function(e){return Object(f.a)(Object(f.a)({},e),{},{rotation:new p.Quaternion(0,0,0,1),scale:new p.Vector3(1,1,1),selected:!1})})),player:Object(f.a)(Object(f.a)({},t.player),{},{position:new p.Vector3(0,0,0),rotation:new p.Quaternion(0,0,0,1),scale:new p.Vector3(1,1,1),selected:!1})})},tryMovePlayer:function(t){var r=n(),o=M(r.player.position,t);if(r.containsGround(o)&&!r.containsBlock(o)){var a=r.step-1,c=new p.Vector3(-1,0,0),u=p.MathUtils.degToRad(-90),i=0!==a?[x(r.player.position,o)]:[x(r.player.position,o)].concat(Object(s.a)(r.blocks.map((function(e){return x(e.position,M(e.position,[0,0,1]))}))),Object(s.a)(r.blocks.map((function(e){return V(e.rotation,A(e.rotation,c,u))}))));return e({step:0===a?2:a,animation:{duration:250,onFrame:function(e){return i.forEach((function(n){return n(e)}))},onRest:function(){e({animation:null})}}}),!0}return!1},placeBomb:function(){var t,r=n(),o=null!==(t=r.getBomb())&&void 0!==t?t:r.groundAt(r.player.position),a=r.ground.indexOf(o);if(o.selected){var c=r.blockAt(o.position);if(c&&r.canExplode(c)){for(var u=[],i=[c];i.length>0;){var l=i.shift();u.push(l),"sp"===l.type&&(G(i,r.blockAt(M(c.position,[-1,0,0])),(function(e){return e&&r.canExplode(e)})),G(i,r.blockAt(M(c.position,[1,0,0])),(function(e){return e&&r.canExplode(e)})),G(i,r.blockAt(M(c.position,[0,0,-1])),(function(e){return e&&r.canExplode(e)})),G(i,r.blockAt(M(c.position,[0,0,1])),(function(e){return e&&r.canExplode(e)})),G(i,r.blockAt(M(c.position,[-1,0,-1])),(function(e){return e&&r.canExplode(e)})),G(i,r.blockAt(M(c.position,[1,0,-1])),(function(e){return e&&r.canExplode(e)})),G(i,r.blockAt(M(c.position,[1,0,-1])),(function(e){return e&&r.canExplode(e)})),G(i,r.blockAt(M(c.position,[-1,0,1])),(function(e){return e&&r.canExplode(e)})))}var m=new p.Vector3(0,0,0),d=new p.Vector3(0,1,0),b=p.MathUtils.degToRad(359),E=[].concat(Object(s.a)(u.map((function(e){return x(e.scale,m)}))),Object(s.a)(u.map((function(e){return V(e.rotation,A(e.rotation,d,b))}))));e({animation:{duration:250,onFrame:function(e){return E.forEach((function(n){return n(e)}))},onRest:function(){e({animation:null})}}})}}return e({ground:O(r.ground,a,(function(e){return Object(f.a)(Object(f.a)({},e),{},{selected:!e.selected})}))}),!o.selected}};var t,r,o}));function M(e,n){return new p.Vector3(e.x+n[0],e.y+n[1],e.z+n[2])}function x(e,n){var t=e.clone();return function(r){e.lerpVectors(t,n,r)}}function A(e,n,t){return e.clone().multiply((new p.Quaternion).setFromAxisAngle(n,t))}function V(e,n){var t=e.clone(),r=e.clone();return function(o){e.copy(t.slerp(n,o)),t.copy(r)}}function G(e,n,t){t(n)&&e.push(n)}var S=function(e){var n=j((function(e){return e.setCubeGeometry})),t=j((function(e){return e.setGroundMaterial})),o=j((function(e){return e.setNormalMaterial})),a=j((function(e){return e.setSpecialMaterial})),c=j((function(e){return e.setSteelMaterial})),u=j((function(e){return e.setBombMaterial})),s=Object(i.d)(),f=Object(l.a)(s,2),p=f[0],m=f[1],d=Object(i.d)(),b=Object(l.a)(d,2),E=b[0],g=b[1],w=Object(i.d)(),y=Object(l.a)(w,2),v=y[0],k=y[1],O=Object(i.d)(),h=Object(l.a)(O,2),M=h[0],x=h[1],A=Object(i.d)(),V=Object(l.a)(A,2),G=V[0],S=V[1],C=Object(i.d)(),q=Object(l.a)(C,2),F=q[0],L=q[1];return console.log("[GameCache] const"),r.useEffect((function(){return B(m,n)}),[n,m]),r.useEffect((function(){return B(g,t)}),[t,g]),r.useEffect((function(){return B(k,o)}),[o,k]),r.useEffect((function(){return B(x,a)}),[a,x]),r.useEffect((function(){return B(S,c)}),[c,S]),r.useEffect((function(){return B(L,u)}),[u,L]),r.createElement(r.Fragment,null,r.createElement("boxBufferGeometry",{ref:p,args:[1,1,1]}),r.createElement("meshStandardMaterial",{ref:E,color:"black",transparent:!0,wireframe:!0}),r.createElement("meshStandardMaterial",{ref:v,color:"gray",transparent:!0}),r.createElement("meshStandardMaterial",{ref:M,color:"green",transparent:!0}),r.createElement("meshStandardMaterial",{ref:G,color:"black",transparent:!0}),r.createElement("meshStandardMaterial",{ref:F,color:"orange",transparent:!0}),m&&g&&k&&x&&S&&L&&e.children)},B=function(e,n){e&&(console.log("[GameCache] useEffect",e),n(e))},C=r.memo((function(e){var n=e.type,t=e.position,o=e.rotation,a=e.scale,c=e.selected,u=r.useRef(null),s=r.useState(null),f=Object(l.a)(s,2),p=f[0],m=f[1],d=j((function(e){return e.cubeGeometry})),b=j((function(e){return e.groundMaterial})),E=j((function(e){return e.normalMaterial})),g=j((function(e){return e.specialMaterial})),w=j((function(e){return e.steelMaterial})),y=j((function(e){return e.bombMaterial}));return console.log("[Cube] const"),r.useEffect((function(){if(c)m(y);else switch(n){case"pl":case"no":m(E);break;case"sp":m(g);break;case"st":m(w);break;case"gr":default:m(b)}}),[m,n,c,d,b,E,g,w,y]),Object(i.c)((function(){u.current.position.copy(t),u.current.quaternion.copy(o),u.current.scale.copy(a)})),r.createElement("mesh",{ref:u,geometry:d,material:p})})),q=function(){var e=j((function(e){return e.ground})),n=j((function(e){return e.blocks})),t=j((function(e){return e.player}));return console.log("[Level] const"),r.createElement(r.Fragment,null,r.createElement("group",{position:[0,-1,0]},e.map((function(e){return r.createElement(C,Object.assign({key:e.uuid},e))}))),n.map((function(e){return r.createElement(C,Object.assign({key:e.uuid},e))})),r.createElement(C,t))},F=t(33),L=r.memo((function(e){var n=e.duration,t=e.onFrame,o=e.onRest;return console.log("[Animation] const"),Object(F.a)({config:{duration:n},from:{opacity:0},to:{opacity:1},reset:!0,onRest:o,onFrame:function(e){return t(e.opacity)}}),r.createElement(r.Fragment,null)})),R=function(){var e=j((function(e){return e.tryMovePlayer})),n=j((function(e){return e.placeBomb})),t=j((function(e){return e.animation})),o=y("w"),a=y("a"),c=y("s"),u=y("d"),i=y(" ");return r.useEffect((function(){t||o&&e([0,0,-1])||a&&e([-1,0,0])||c&&e([0,0,1])||u&&e([1,0,0])||i&&n()}),[t,o,a,c,u,i,e,n]),t?r.createElement(L,t):r.createElement(r.Fragment,null)};Object(i.b)({OrbitControls:u.a});var Q=function(){var e=r.useRef(null),n=Object(i.e)(),t=n.camera,o=n.gl.domElement;return console.log("[OrbitControlsElement] const"),Object(i.c)((function(){return e.current.update()})),r.createElement("orbitControls",{ref:e,args:[t,o]})},N=function(){return console.log("[Game] const"),r.createElement(i.a,null,r.createElement("ambientLight",null),r.createElement("pointLight",{position:[10,10,10]}),r.createElement(Q,null),r.createElement(R,null),r.createElement(S,null,r.createElement(q,null)))};var J=function(){return o.a.createElement("div",{className:"vh-100 vw-100"},o.a.createElement(N,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(J,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[34,1,2]]]);
//# sourceMappingURL=main.9f3a3e6a.chunk.js.map