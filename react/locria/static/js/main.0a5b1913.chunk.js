(this.webpackJsonplocria=this.webpackJsonplocria||[]).push([[0],{25:function(e,t,n){e.exports=n(68)},30:function(e,t,n){},68:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(10),c=n.n(r),i=(n(30),n(1)),s=n.n(i),u=n(11),l=n(4),d=n(2),m=n(22),f=n(23);var p=Object(f.a)((function(e,t){return{osmd:{instance:null,connected:!1,loaded:!1},midi:{instance:null,connected:!1,loaded:!1,envelopes:[]},actions:{osmdUpdate:function(n){e({osmd:Object(d.a)(Object(d.a)({},t().osmd),n)})},osmdConnect:function(e){console.log("[OSMD] attaching osmd to div",e),t().actions.osmdUpdate({instance:new m.OpenSheetMusicDisplay(e,{}),connected:!0}),t().actions.osmdLoad("assets/Angel_Beats_-_My_Soul_Your_Beats.xml")},osmdLoad:function(e){t().osmd.instance.load(e).then((function(){t().osmd.instance.render(),t().osmd.instance.cursor.show(),t().actions.osmdUpdate({loaded:!0})}))},osmdCursorNext:function(){t().osmd.instance.cursor.next()},osmdCursorPrevious:function(){var e=t().osmd.instance.cursor,n=e.iterator.currentTimeStamp.RealValue;if(n>0){var a=0;for(e.reset();e.iterator.currentTimeStamp.RealValue!==n;)a++,e.next();for(console.log("timestampIndex",a),a--,e.reset();a>0;)a--,e.next()}},midiUpdate:function(n){e({midi:Object(d.a)(Object(d.a)({},t().midi),n)})},midiConnect:function(e){"running"===e.audioContext.state&&e.audioContext.suspend(),t().actions.midiUpdate({instance:e,connected:!0}),e.player.loader.waitLoad((function(){return t().actions.midiUpdate({loaded:!0})}))},locriaPlay:function(){var e=t().midi.instance,n=Array.from(t().utils.osmdGetNotes()),a=[];t().actions.locriaStop(),e.audioContext.resume();for(var o=function(){var n=Object(l.a)(c[r],2)[1],o=t().utils.midiInstrumentPreset(n[0].instrument);n.forEach((function(t){a.push(e.player.queueWaveTable(e.audioContext,e.audioContext.destination,o,e.audioContext.currentTime+t.time,t.note,t.duration,.1))}))},r=0,c=Object.entries(function(e,t){return e.reduce((function(e,n){var a=t(n);return e[a]||(e[a]=[]),e[a].push(n),e}),{})}(n,(function(e){return e.instrument})));r<c.length;r++)o();t().actions.midiUpdate({envelopes:a})},locriaStop:function(){t().midi.envelopes.forEach((function(e){return e.cancel()})),t().actions.midiUpdate({envelopes:[]}),t().midi.instance.audioContext.suspend()}},utils:{osmdGetNotes:s.a.mark((function e(){var n,a,o,r,c,i,l,d,m,f,p,b;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t(),a=n.osmd.instance.cursor,o=a.iterator.currentTimeStamp.RealValue,console.log("gathering notes starting at",o),r=a.iterator.clone();case 4:if(r.EndReached){e.next=45;break}if(!(r.currentTimeStamp.RealValue<o)){e.next=7;break}return e.abrupt("continue",42);case 7:c=145,i=Object(u.a)(r.CurrentVoiceEntries),e.prev=9,i.s();case 11:if((l=i.n()).done){e.next=34;break}d=l.value,m=Object(u.a)(d.Notes.filter((function(e){return null!==e&&0!==e.halfTone}))),e.prev=14,m.s();case 16:if((f=m.n()).done){e.next=24;break}if((p=f.value).NoteTie&&p.NoteTie.Notes[0]!==p){e.next=22;break}return b=4*(p.NoteTie?p.NoteTie.Duration.RealValue:p.Length.RealValue)*60/c,e.next=22,{instrument:p.ParentStaff.ParentInstrument.MidiInstrumentId,time:4*(r.currentTimeStamp.RealValue-o)*60/c,note:p.halfTone+12,duration:b};case 22:e.next=16;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(14),m.e(e.t0);case 29:return e.prev=29,m.f(),e.finish(29);case 32:e.next=11;break;case 34:e.next=39;break;case 36:e.prev=36,e.t1=e.catch(9),i.e(e.t1);case 39:return e.prev=39,i.f(),e.finish(39);case 42:r.moveToNext(),e.next=4;break;case 45:case"end":return e.stop()}}),e,null,[[9,36,39,42],[14,26,29,32]])})),midiInstrumentPreset:function(e){return window[t().midi.instance.player.loader.instrumentInfo(e).variable]}}}})),b=function(){var e=p((function(e){return e.osmd})).loaded,t=p((function(e){return e.midi})).loaded,n=p((function(e){return e.actions})),o=n.osmdCursorNext,r=n.osmdCursorPrevious,c=n.locriaPlay,i=n.locriaStop;return console.log("[LocriaPlayback] render"),a.createElement("div",{className:"d-flex justify-content-center"},e&&t?a.createElement("div",{className:"btn-toolbar m-1",role:"toolbar"},a.createElement("div",{className:"btn-group btn-group-sm mr-2"},a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:c},a.createElement("i",{className:"fas fa-play fa-fw"})),a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:i},a.createElement("i",{className:"fas fa-stop fa-fw"}))),a.createElement("div",{className:"btn-group btn-group-sm"},a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:r},a.createElement("i",{className:"fas fa-step-backward fa-fw"})),a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:o},a.createElement("i",{className:"fas fa-step-forward fa-fw"})))):a.createElement("div",{className:"m-1"},"Loading..."))},v=function(){var e=p((function(e){return e.actions})).osmdConnect,t=a.useRef(null);return console.log("[LocriaOSMD] render"),a.useEffect((function(){e(t.current)}),[t,e]),a.createElement("div",{ref:t})},h=n(24),x=n.n(h),E=function(){var e=p((function(e){return e.actions})).midiConnect;return console.log("[LocriaMIDI] render"),a.createElement("div",{className:"d-none"},a.createElement(x.a,{ref:function(t){return e(t)},instruments:[0]}))},g=function(){return console.log("[Locria] render"),a.createElement(a.Fragment,null,a.createElement(E,null),a.createElement(a.StrictMode,null,a.createElement(b,null),a.createElement(v,null)))};var N=function(){return o.a.createElement(g,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(N,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[25,1,2]]]);
//# sourceMappingURL=main.0a5b1913.chunk.js.map