(this.webpackJsonplocria=this.webpackJsonplocria||[]).push([[0],{25:function(e,n,t){e.exports=t(68)},30:function(e,n,t){},68:function(e,n,t){"use strict";t.r(n);var o=t(0),r=t.n(o),a=t(10),i=t.n(a),c=(t(30),t(1)),s=t.n(c),u=t(11),l=t(2),d=t(3),m=t(22),f=t(23);var p=function(e,n){return e.reduce((function(e,t){var o=n(t);return e[o]||(e[o]=[]),e[o].push(t),e}),{})},v=Object(f.a)((function(e,n){return{osmd:{instance:null,connected:!1,loaded:!1},midi:{instance:null,connected:!1,loaded:!1},actions:{osmdUpdate:function(t){e({osmd:Object(d.a)(Object(d.a)({},n().osmd),t)})},osmdConnect:function(e){console.log("[OSMD] attaching osmd to div",e),n().actions.osmdUpdate({instance:new m.OpenSheetMusicDisplay(e,{}),connected:!0}),n().actions.osmdLoad("assets/Angel_Beats_-_My_Soul_Your_Beats.xml")},osmdLoad:function(e){n().osmd.instance.load(e).then((function(){n().osmd.instance.render(),n().actions.osmdUpdate({loaded:!0})}))},midiUpdate:function(t){e({midi:Object(d.a)(Object(d.a)({},n().midi),t)})},midiConnect:function(e){"running"===e.audioContext.state&&e.audioContext.suspend(),n().actions.midiUpdate({instance:e,connected:!0}),e.player.loader.waitLoad((function(){return n().actions.midiUpdate({loaded:!0})}))},locriaPlay:function(){for(var e=n().midi.instance,t=Array.from(n().utils.osmdGetNotes()),o=0,r=Object.entries(p(t,(function(e){return e.instrument})));o<r.length;o++)for(var a=Object(l.a)(r[o],2)[1],i=0,c=Object.entries(p(a,(function(e){return"".concat(e.time,"-").concat(e.duration)})));i<c.length;i++){var s=Object(l.a)(c[i],2)[1];e.player.queueChord(e.audioContext,e.audioContext.destination,n().utils.midiInstrumentPreset(s[0].instrument),e.audioContext.currentTime+s[0].time,s.map((function(e){return e.note})),s[0].duration,.1)}console.log(e,p(t,(function(e){return e.instrument})))}},utils:{osmdGetNotes:s.a.mark((function e(){var t,o,r,a,i,c,l,d,m,f,p,v;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n(),o=t.osmd.instance,(r=o.cursor).reset(),a=r.iterator;case 4:if(a.EndReached){e.next=43;break}i=120,c=Object(u.a)(a.CurrentVoiceEntries),e.prev=7,c.s();case 9:if((l=c.n()).done){e.next=32;break}d=l.value,m=Object(u.a)(d.Notes.filter((function(e){return null!==e&&0!==e.halfTone}))),e.prev=12,m.s();case 14:if((f=m.n()).done){e.next=22;break}if((p=f.value).NoteTie&&p.NoteTie.Notes[0]!==p){e.next=20;break}return v=4*(p.NoteTie?p.NoteTie.Duration.RealValue:p.Length.RealValue)*60/i,e.next=20,{instrument:p.ParentStaff.ParentInstrument.MidiInstrumentId,time:4*a.currentTimeStamp.RealValue*60/i,note:p.halfTone+12,duration:v};case 20:e.next=14;break;case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(12),m.e(e.t0);case 27:return e.prev=27,m.f(),e.finish(27);case 30:e.next=9;break;case 32:e.next=37;break;case 34:e.prev=34,e.t1=e.catch(7),c.e(e.t1);case 37:return e.prev=37,c.f(),e.finish(37);case 40:a.moveToNext(),e.next=4;break;case 43:case"end":return e.stop()}}),e,null,[[7,34,37,40],[12,24,27,30]])})),midiInstrumentPreset:function(e){return window[n().midi.instance.player.loader.instrumentInfo(e).variable]}}}})),b=function(){var e=v((function(e){return e.osmd})).loaded,n=v((function(e){return e.midi})).loaded,t=v((function(e){return e.actions})).locriaPlay;return console.log("[LocriaPlayback] render"),o.createElement("div",null,o.createElement("button",{type:"button",onClick:t,disabled:!(e&&n)},o.createElement("i",{className:"fas fa-play"})))},h=function(){var e=v((function(e){return e.actions})).osmdConnect,n=o.useRef(null);return console.log("[LocriaOSMD] render"),o.useEffect((function(){e(n.current)}),[n,e]),o.createElement("div",{ref:n})},x=t(24),g=t.n(x),E=function(){var e=v((function(e){return e.actions})).midiConnect;return console.log("[LocriaMIDI] render"),o.createElement("div",{className:"d-none"},o.createElement(g.a,{ref:function(n){return e(n)},instruments:[0]}))},k=function(){return console.log("[Locria] render"),o.createElement(o.Fragment,null,o.createElement(E,null),o.createElement(o.StrictMode,null,o.createElement(b,null),o.createElement(h,null)))};var w=function(){return r.a.createElement(k,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(w,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[25,1,2]]]);
//# sourceMappingURL=main.48979da1.chunk.js.map